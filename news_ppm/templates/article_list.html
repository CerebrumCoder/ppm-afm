{% extends "base.html" %}

{% block title %}Artikel AFM - PPM Al-Faqih Mandiri{% endblock %}

{% block content %}
<section class="mb-8">
  <!-- Header -->
  <div class="mb-4 flex flex-wrap items-center justify-between gap-2">
    <div>
      <h1 class="text-xl font-semibold tracking-tight sm:text-2xl">
        Artikel AFM
      </h1>
      <p class="mt-1 text-xs text-slate-600 dark:text-slate-300">
        Kumpulan berita, pengumuman, dan cerita kegiatan di PPM Al-Faqih Mandiri.
      </p>
    </div>
  </div>

  {% if articles %}
    {# ARTIKEL UNGGULAN (artikel pertama) #}
    {% with articles|slice:":1" as featured_list %}
      {% for article in featured_list %}
        <a
          href="{% url 'news:article_detail' article.pk %}"
          class="group mb-8 flex flex-col overflow-hidden rounded-3xl border border-slate-200 bg-white/95 shadow-sm transition
                 hover:-translate-y-0.5 hover:shadow-lg hover:border-lime-300
                 dark:border-slate-700 dark:bg-slate-900/80 dark:hover:border-lime-500/60"
        >
          <div class="relative h-56 w-full overflow-hidden sm:h-64">
            {% if article.thumbnail %}
              <img
                src="{{ article.thumbnail.url }}"
                alt="{{ article.title }}"
                class="h-full w-full object-cover transition-transform duration-700 group-hover:scale-105"
              />
            {% elif article.thumbnail_url %}
              <img
                src="{{ article.thumbnail_url }}"
                alt="{{ article.title }}"
                class="h-full w-full object-cover transition-transform duration-700 group-hover:scale-105"
              />
            {% else %}
              <div class="flex h-full w-full items-center justify-center bg-slate-900 text-slate-300">
                Tidak ada thumbnail
              </div>
            {% endif %}

            <div class="absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/85 via-black/40 to-transparent px-4 pb-3 pt-12">
              <p class="text-[11px] uppercase tracking-wide text-lime-300">
                {% if article.published_at %}
                  {{ article.published_at|date:"j F Y" }}
                {% else %}
                  Belum dijadwalkan
                {% endif %}
              </p>
              <h2 class="mt-1 text-base font-semibold leading-snug text-white sm:text-lg">
                {{ article.title }}
              </h2>
              <p class="mt-1 line-clamp-2 text-[11px] text-slate-100/80">
                {{ article.content|striptags|truncatewords:22 }}
              </p>
              {% if article.author %}
                <p class="mt-2 text-[10px] text-slate-300">
                  Oleh {{ article.author.get_full_name|default:article.author.username }}
                </p>
              {% endif %}
            </div>
          </div>
        </a>
      {% endfor %}
    {% endwith %}

    {# ARTIKEL LAINNYA #}
    {% with articles|slice:"1:" as rest %}
      {% if rest %}
        <h3 class="mb-3 text-sm font-semibold text-slate-700 dark:text-slate-100">
          Artikel terbaru lainnya
        </h3>
        <div class="grid gap-5 md:grid-cols-2 lg:grid-cols-3">
          {% for article in rest %}
            <a
              href="{% url 'news:article_detail' article.pk %}"
              class="group flex h-full flex-col overflow-hidden rounded-2xl border border-slate-200 bg-white/90 shadow-sm ring-0 transition
                     hover:-translate-y-0.5 hover:shadow-md hover:ring-1 hover:ring-lime-300
                     dark:border-slate-700 dark:bg-slate-900/70 dark:hover:ring-lime-500/60"
            >
              {% if article.thumbnail %}
                <div class="h-36 w-full overflow-hidden bg-slate-200">
                  <img
                    src="{{ article.thumbnail.url }}"
                    alt="{{ article.title }}"
                    class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"
                  />
                </div>
              {% elif article.thumbnail_url %}
                <div class="h-36 w-full overflow-hidden bg-slate-200">
                  <img
                    src="{{ article.thumbnail_url }}"
                    alt="{{ article.title }}"
                    class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"
                  />
                </div>
              {% endif %}

              <div class="flex flex-1 flex-col p-4">
                <p class="text-[11px] uppercase tracking-wide text-lime-700 dark:text-lime-300">
                  {% if article.published_at %}
                    {{ article.published_at|date:"j M Y" }}
                  {% else %}
                    Belum dijadwalkan
                  {% endif %}
                </p>
                <h2 class="mt-1 text-sm font-semibold leading-snug text-slate-900 dark:text-slate-50">
                  {{ article.title }}
                </h2>
                <p class="mt-1 line-clamp-3 text-[11px] text-slate-600 dark:text-slate-300">
                  {{ article.content|striptags|truncatewords:20 }}
                </p>
                {% if article.author %}
                  <p class="mt-2 text-[10px] text-slate-500 dark:text-slate-400">
                    Oleh {{ article.author.get_full_name|default:article.author.username }}
                  </p>
                {% endif %}
              </div>
            </a>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
  {% else %}
    <p class="text-sm text-slate-600 dark:text-slate-300">
      Belum ada artikel yang dipublikasikan.
    </p>
  {% endif %}
</section>
{% endblock %}
